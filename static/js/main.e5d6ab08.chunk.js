(this.webpackJsonptournroute=this.webpackJsonptournroute||[]).push([[0],{108:function(e,t,a){e.exports=a(119)},113:function(e,t,a){},114:function(e,t,a){},115:function(e,t,a){},116:function(e,t,a){},119:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),r=a(90),s=a.n(r),o=(a(113),a(114),a(115),a(116),a(54)),i=a(55),l=a(80),m=a(78),u=a(61),d=a(126),p=a(92),y=a(91),h=a(76),f=a(8),v=a(124),b=a(128),g=a(127),E=a(125),w=a(79),N=a(85),j=a(129),k=function(e){Object(l.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e))._map=null,n.url_osrm_nearest="//router.project-osrm.org/nearest/v1/foot/",n.url_osrm_route="//router.project-osrm.org/route/v1/foot/",n.icon_url="https://openlayers.org/en/v4.6.5/examples/data/icon.png",n.state={height:300,center:[10.6,49.6]},n.getBounds=n.getBounds.bind(Object(u.a)(n)),n.updateDimensions=n.updateDimensions.bind(Object(u.a)(n)),n}return Object(i.a)(a,[{key:"updateDimensions",value:function(){var e=this;this.setState({height:this.getBounds().height},(function(){try{e._map.setSize([e.getBounds().width,e.getBounds().height])}catch(t){}}))}},{key:"getBounds",value:function(){var e=300,t=400;try{e=3*(t=this._mapEl.clientWidth)/4}catch(a){}return{width:t,height:e}}},{key:"setCoors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._map.getView().setCenter(Object(f.d)(e)),t&&this._map.getView().setZoom(t)}},{key:"setPoints",value:function(e){var t=this;this._map.addLayer(new v.a({id:"points",source:new g.a({features:e.reverse().map((function(e){var a=new y.a({geometry:new h.a(Object(f.d)(e)),name:"New Marker"}),n=new N.b({image:new j.a({anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels",src:t.icon_url})});return a.setStyle(n),a}))})}))}},{key:"setRoute",value:function(e){var t=this,a=e.map((function(e){return Object(f.l)(e).join()})).join(";");console.log("[setRoute]",a),fetch(this.url_osrm_route+a).then((function(e){return e.json()})).then((function(e){"Ok"===e.code?console.log(e):console.warn("[E][OLMap] Error on ".concat(t.url_osrm_route+a," request."))}))}},{key:"removeLayer",value:function(e){var t=this;this._map.getLayers().forEach((function(a){try{a.get("id")===e&&t._map.removeLayer(a)}catch(n){}}))}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.updateDimensions),this.updateDimensions(),this._map=new d.a({target:"map",layers:[new b.a({id:"map",source:new E.a({url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",projection:"EPSG:3857"})})],controls:Object(w.a)({rotate:!1}),view:new p.a({projection:"EPSG:3857",center:Object(f.d)(this.state.center),zoom:4})})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions)}},{key:"render",value:function(){var e=this,t={width:"100%",height:this.state.height,backgroundColor:"#cccccc"};return c.a.createElement("div",null,c.a.createElement("div",{id:"map",style:t,ref:function(t){e._mapEl=t}}))}}]),a}(c.a.Component),C=a(41),x=a(44),O=a.n(x),_=a(67),S="4ldhsh3zxfur",D="muZKwjJvwP5jz8Raxs0Adwb2pQ2PYBZ3zrFVIwMxgok",P=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,null,[{key:"getData",value:function(){var e=Object(_.a)(O.a.mark((function e(){var t,a,n,c,r,s,o,i,l,m,u,d,p=arguments;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=p.length>0&&void 0!==p[0]?p[0]:"country",a=p.length>1&&void 0!==p[1]?p[1]:0,n=p.length>2?p[2]:void 0,c=32,s="",n&&n.hasOwnProperty("country")&&(s='where: { country: { sys: { id: "'.concat(n.country,'" } } }')),n&&n.hasOwnProperty("city")&&(s='where: { city: { sys: { id: "'.concat(n.city,'" } } }')),o="{ ".concat(t,"Collection(limit: ").concat(c," skip: ").concat(a," ").concat(s,") { total, items { name, country { name, sys { id } }, galleryCollection { items { title, url } }, coordinates { lat, lon }, description { json }, sys { id } } } }"),i="{ ".concat(t,"Collection(limit: ").concat(c," skip: ").concat(a," ").concat(s,") { total, items { name, schedule { json }, description { json }, galleryCollection { items { title, url } }, sys { id }, city { name, sys { id }, country { name, sys { id } } }, coordinates { lat, lon } } } }"),l="{ ".concat(t,"Collection { items { name, galleryCollection { total, items { title, url, sys { id } } }, sys { id } } } }"),m="{ ".concat(t,"Collection(limit: ").concat(c," skip: ").concat(a," ").concat(s,") { total, items { name, description { json }, placesCollection { items { name, schedule { json }, description { json }, sys { id }, coordinates { lat, lon } } }, sys { id }, city { name, coordinates { lat, lon }, sys { id }, country { name, sys { id } } } } } }"),e.t0=t,e.next="country"===e.t0?14:"city"===e.t0?16:"place"===e.t0?18:"route"===e.t0?20:22;break;case 14:return r=l,e.abrupt("break",22);case 16:return r=o,e.abrupt("break",22);case 18:return r=i,e.abrupt("break",22);case 20:return r=m,e.abrupt("break",22);case 22:if(0!==r.length){e.next=24;break}return e.abrupt("return",[]);case 24:return e.next=26,window.fetch("https://graphql.contentful.com/content/v1/spaces/".concat(S,"/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(D)},body:JSON.stringify({query:r})});case 26:return u=e.sent,e.next=29,u.json();case 29:return d=e.sent,e.abrupt("return",d.data["".concat(t,"Collection")]);case 31:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getCollection",value:function(){var e=Object(_.a)(O.a.mark((function e(t,a){var n,c,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=11;break}return n="{ ".concat(t,'Collection(where: { country: { sys: { id: "').concat(a,'" } } } ) { items { name, country { name, sys { id } }, galleryCollection { items { title, url } }, coordinates { lat, lon }, description { json }, sys { id } } } }'),e.next=4,window.fetch("https://graphql.contentful.com/content/v1/spaces/".concat(S,"/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(D)},body:JSON.stringify({query:n})});case 4:return c=e.sent,e.next=7,c.json();case 7:return r=e.sent,e.abrupt("return",r.data["".concat(t,"Collection")]);case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getEntry",value:function(){var e=Object(_.a)(O.a.mark((function e(t,a){var n,c,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=11;break}return n="{ ".concat(t,'(id: "').concat(a,'") { name } }'),e.next=4,window.fetch("https://graphql.contentful.com/content/v1/spaces/".concat(S,"/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(D)},body:JSON.stringify({query:n})});case 4:return c=e.sent,e.next=7,c.json();case 7:return r=e.sent,e.abrupt("return",r.data[t]);case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getAsset",value:function(){var e=Object(_.a)(O.a.mark((function e(t){var a,n,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=11;break}return a='{ asset(id: "'.concat(t,'") { title, description, url } }'),e.next=4,window.fetch("https://graphql.contentful.com/content/v1/spaces/".concat(S,"/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(D)},body:JSON.stringify({query:a})});case 4:return n=e.sent,e.next=7,n.json();case 7:return c=e.sent,e.abrupt("return",c.data);case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function T(e){var t=e.select,a=c.a.useState([]),n=Object(C.a)(a,2),r=n[0],s=n[1];return c.a.useEffect((function(){P.getData("country").then((function(e){s(e.items)}))}),[]),c.a.createElement("div",{className:"row mt-3"},r.map((function(e,a){return c.a.createElement("div",{className:"col-12 col-md-6 col-lg-4 mt-3",key:e.sys.id,onClick:function(){try{P.getCollection("city",e.sys.id).then((function(a){t(e,a.items,e.sys.id)}))}catch(a){console.error("[E] Countries: unable to select country",a)}}},c.a.createElement("div",{className:"card bg-primary text-white ux-cursor-pointer"},c.a.createElement("div",{className:"position-relative"},e.galleryCollection?c.a.createElement("img",{src:e.galleryCollection.items[0].url,className:"card-img-top ux-card-img",alt:e.galleryCollection.items[0].title}):c.a.createElement("div",{style:{height:"150px"}}),c.a.createElement("div",{className:"card-body ux-card-body py-2 px-3 "},c.a.createElement("h4",{className:"m-0 font-weight-bolder"},e.name),e.linkedFrom&&c.a.createElement("h6",{className:"m-0 font-weight-bolder"},e.linkedFrom.cityCollection.items.map((function(e,t){return c.a.createElement("small",{className:"mr-2",key:"country-city-".concat(e.sys.id)},e.name)}))))),c.a.createElement("div",{className:"card-footer py-2 px-3 bg-primary d-flex align-items-center justify-content-between"},c.a.createElement("span",{className:"small stretched-link"},"View Cities"),c.a.createElement("div",{className:"small"},c.a.createElement("i",{className:"fa fa-arrow-circle-right"})))))})))}function B(e){var t=e.select,a=e.list,n=void 0===a?[]:a,r=c.a.useState(n),s=Object(C.a)(r,2),o=s[0],i=s[1];return c.a.useEffect((function(){0===n.length&&P.getData("city").then((function(e){i(e.items)}))}),[n]),c.a.createElement("div",{className:"row mt-3"},o.map((function(e,a){return c.a.createElement("div",{className:"col-12 col-md-6 col-lg-4 mt-3",key:e.sys.id,onClick:function(){try{t(e,e.sys.id)}catch(a){console.error("[E] Cities: unable to select city",a)}}},c.a.createElement("div",{className:"card bg-success text-white ux-cursor-pointer"},c.a.createElement("div",{className:"position-relative"},e.galleryCollection?c.a.createElement("img",{src:e.galleryCollection.items[0].url,className:"card-img-top ux-card-img",alt:e.galleryCollection.items[0].title}):c.a.createElement("div",{style:{height:"150px"}}),c.a.createElement("div",{className:"card-body ux-card-body py-2 px-3 "},e.country&&c.a.createElement("h6",{className:"m-0 font-weight-bolder"},c.a.createElement("small",null,e.country.name)),c.a.createElement("h4",{className:"m-0 font-weight-bolder"},e.name))),c.a.createElement("div",{className:"card-footer py-2 px-3 bg-success d-flex align-items-center justify-content-between"},c.a.createElement("span",{className:"small stretched-link"},"View Places"),c.a.createElement("div",{className:"small"},c.a.createElement("i",{className:"fa fa-arrow-circle-right"})))))})))}var z=a(87),R=a(53);function I(e){var t=e.place,a=e.index,n=e.select;return c.a.createElement("div",{className:"col-6 mt-3",key:"place-item-".concat(a),onClick:function(){try{P.getEntry("place",t.sys.id).then((function(e){console.log(e)}))}catch(e){console.error("[E] Places: unable to load place data",e)}try{n(t,t.sys.id)}catch(e){console.error("[E] Places: unable to select place",e)}}},c.a.createElement("div",{className:"card ux-place-card ux-cursor-pointer"},c.a.createElement("div",{className:"position-relative"},t.galleryCollection.items.length>0?c.a.createElement("img",{src:t.galleryCollection.items[0].url,className:"card-img-top ux-card-img",alt:t.galleryCollection.items[0].title,style:{height:"250px"}}):c.a.createElement("div",{className:"card-img-top ux-bg-gradient",style:{height:"250px"}}),c.a.createElement("div",{className:"card-body ux-card-body top text-white py-2 px-3 "},c.a.createElement("h5",{className:"m-0 font-weight-bolder"},t.name),t.city&&c.a.createElement("h6",{className:"m-0 font-weight-bolder"},c.a.createElement("small",null,t.city.name,", ",t.city.country.name))),t.schedule&&c.a.createElement("div",{className:"card-body ux-card-body text-white py-2 px-3 place-schedule"},c.a.createElement("small",null,Object(R.documentToReactComponents)(t.schedule.json)))),c.a.createElement("div",{className:"card-body place-description"},Object(R.documentToReactComponents)(t.description.json))))}function L(e){var t=e.select,a=e.list,n=void 0===a?[]:a,r=e.city,s=e.country,o=c.a.useState(n),i=Object(C.a)(o,2),l=i[0],m=i[1],u=c.a.useState(n.length),d=Object(C.a)(u,2),p=d[0],y=d[1],h=c.a.useState({}),f=Object(C.a)(h,2),v=f[0],b=f[1],g=c.a.useState(n.length),E=Object(C.a)(g,2),w=E[0],N=E[1];return c.a.useEffect((function(){var e={};r&&(e.city=r),s&&(e.country=s),0===n.length&&P.getData("place",0,e).then((function(t){y(t.total),m(t.items),b(e)}))}),[]),c.a.useEffect((function(){N(p-l.length)}),[p,l.length]),c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"row mt-3"},l.map((function(e,a){return c.a.createElement(I,{select:t,place:e,index:a,key:"place-".concat(a)})}))),w>0&&c.a.createElement("div",{className:"mt-4 text-center"},c.a.createElement("button",{className:"btn btn-link btn-outline",onClick:function(){P.getData("place",l.length,v).then((function(e){m([].concat(Object(z.a)(l),Object(z.a)(e.items))),N(e.total-l.length)}))}},"Load more (",w,")")))}function q(e){var t=e.select,a=e.selectPlace,n=e.list,r=void 0===n?[]:n,s=e.city,o=e.country,i=c.a.useState(r),l=Object(C.a)(i,2),m=l[0],u=l[1];return c.a.useEffect((function(){0===r.length&&P.getData("route").then((function(e){if(s.length>0||o.length>0){var t=e.items.filter((function(e){return s.length>0?e.city.sys.id===s:o.length>0&&e.city.country.sys.id===o}));u(t)}else u(e.items)}))}),[]),c.a.createElement("div",{className:"row mt-3"},m.map((function(e){return c.a.createElement("div",{className:"col-12 mt-3",key:e.sys.id},c.a.createElement("div",{className:"card ux-cursor-pointer",onClick:function(){try{var a=e.placesCollection.items.map((function(e){return[e.coordinates.lon,e.coordinates.lat]}));t(e,a,e.sys.id)}catch(n){console.error("[E] Routes: unable to select route",n)}}},c.a.createElement("div",{className:"card-header bg-primary text-white"},c.a.createElement("div",{className:"d-flex align-items-end justify-content-between"},c.a.createElement("h5",{className:"m-0 font-weight-bolder"},e.name),c.a.createElement("h6",{className:"m-0 font-weight-bolder"},e.city.name,", ",e.city.country.name))),c.a.createElement("div",{className:"card-body"},e.description&&c.a.createElement("div",{className:"route-description"},Object(R.documentToReactComponents)(e.description.json)),c.a.createElement("div",{className:"row"},e.placesCollection.items.map((function(e,t){return c.a.createElement("div",{className:"ux-route-item col-12 py-2",key:e.sys.id,onClick:function(t){t.stopPropagation();try{a(e,e.sys.id)}catch(t){console.error("[E] Routes: unable to select route place",t)}}},c.a.createElement("div",{className:"d-flex align-items-center"},c.a.createElement("div",{className:"mr-3"},c.a.createElement("i",{className:"fa fa-circle text-primary"})),c.a.createElement("div",{className:"card ux-place-card ux-cursor-pointer"},c.a.createElement("div",{className:"card-header"},c.a.createElement("h5",{className:"m-0 font-weight-bolder"},e.name)),e.schedule&&c.a.createElement("div",{className:"card-body pt-3 pb-2 place-schedule"},Object(R.documentToReactComponents)(e.schedule.json)),c.a.createElement("div",{className:"card-body place-description small"},Object(R.documentToReactComponents)(e.description.json)))))}))))))})))}var J=function(e){Object(l.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e))._map=null,n.state={tab:"countries",country:"Countries",countryID:"",city:"Cities",cityID:"",listCities:[],mapCenter:[10.6,49.6]},n}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return c.a.createElement(c.a.Fragment,null,c.a.createElement("nav",{className:"sb-topnav navbar navbar-expand navbar-dark bg-dark py-1"},c.a.createElement("div",{className:"container"},c.a.createElement("h6",{className:"navbar-brand font-weight-bolder mb-0"},"Tour & Route"))),c.a.createElement("div",{className:"ux-gradient"}),c.a.createElement("div",{className:"container px-md-0 mb-5"},c.a.createElement("div",{className:"row"},c.a.createElement("div",{className:"col-12 col-md-7 pt-4"},c.a.createElement("ul",{className:"nav nav-tabs"},c.a.createElement("li",{className:"nav-item mr-1",onClick:function(){e.setState({tab:"countries"})}},c.a.createElement("span",{className:"nav-link ".concat("countries"===this.state.tab?"active":"")},this.state.country)),c.a.createElement("li",{className:"nav-item mr-1",onClick:function(){e.setState({tab:"cities"})}},c.a.createElement("span",{className:"nav-link ".concat("cities"===this.state.tab?"active":"")},this.state.city)),c.a.createElement("li",{className:"nav-item mr-1",onClick:function(){e.setState({tab:"places"})}},c.a.createElement("span",{className:"nav-link ".concat("places"===this.state.tab?"active":"")},"Places")),c.a.createElement("li",{className:"nav-item mr-1",onClick:function(){e.setState({tab:"routes"})}},c.a.createElement("span",{className:"nav-link ".concat("routes"===this.state.tab?"active":"")},"Routes"))),"countries"===this.state.tab&&c.a.createElement(T,{select:function(t,a,n){e.setState({country:t.name,countryID:n,city:"Cities",cityID:"",listCities:a,tab:"cities"})}}),"cities"===this.state.tab&&c.a.createElement(B,{list:this.state.listCities,select:function(t,a){e.setState({tab:"places",city:t.name,cityID:a,mapCenter:[t.coordinates.lon,t.coordinates.lat]},(function(){e._map.setCoors(e.state.mapCenter,9)}))}}),"places"===this.state.tab&&c.a.createElement(L,{city:this.state.cityID,country:this.state.countryID,select:function(t,a){e._map.removeLayer("points"),e._map.setPoints([[t.coordinates.lon,t.coordinates.lat]]),e._map.setCoors([t.coordinates.lon,t.coordinates.lat],15)}}),"routes"===this.state.tab&&c.a.createElement(q,{city:this.state.cityID,country:this.state.countryID,select:function(t,a,n){e._map.removeLayer("points"),e._map.setPoints(a),e._map.setCoors([t.city.coordinates.lon,t.city.coordinates.lat],12)},selectPlace:function(t,a){e._map.removeLayer("points"),e._map.setPoints([[t.coordinates.lon,t.coordinates.lat]]),e._map.setCoors([t.coordinates.lon,t.coordinates.lat],15)}})),c.a.createElement("div",{className:"col-12 col-md-5"},c.a.createElement("div",{className:"sticky-top pt-4"},c.a.createElement("div",{className:"card shadow"},c.a.createElement("div",{className:"card-header"},c.a.createElement("h6",{className:"m-0 font-weight-bold"},"Map view")),c.a.createElement("div",{className:"card-body p-0"},c.a.createElement(k,{ref:function(t){e._map=t},center:this.state.mapCenter}))))))))}}]),a}(c.a.Component);var A=function(){return c.a.createElement(J,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(A,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[108,1,2]]]);
//# sourceMappingURL=main.e5d6ab08.chunk.js.map